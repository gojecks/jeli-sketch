
/**
@license jeli.sketch
Author : Joseph Gojecks
MIT License 

Copyright (c) [] [jeli.sketch]

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
Version 0.2.0
**/


!function(a,b){!function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof module&&module.exports?module.exports=b():a.jsketch=b()}("undefined"!=typeof self?self:this,function(){function a(){var a=[];this.selectedState=null,this.drawingState=null,this.previousState=null,this.reset=function(b){for(var c=a.length;c--;)b(a.shift())},this.addState=function(a,b,c){return this.selectedState={startX:a,startY:b,endX:0,endY:0,isDragable:c,selectable:c,stacks:[]},this},
this.endState=function(b,c){this.selectedState&&(b&&c&&(this.selectedState.endX=b,this.selectedState.endY=c),a.push(this.selectedState),this.clearState())},this.contains=function(b,c,d){var e=null;return a.forEach(function(a,f){a.selectable&&a.startX<=b&&a.endX>=b&&a.startY<=c&&a.endY>=c&&(d?a.isSelected=!0:e={state:a,index:f})}),e},this.pop=function(){return a.pop()},this.forEach=function(b){for(var c=a.length;c--;)b(a[c])},this.getStateByIndex=function(b){return a[b]},
Object.defineProperty(this,"all",{get:function(){return a}})}function b(a,b){var d={width:500,height:500,id:"_canvas_"+ +new Date},e=new c;e.options=n(!0,d,a||{}),e.color="rgb(0,0,0)",e.lineWidth=2,e.eraserMode=!1,e.currentRandomColor="";var f=document.createElement("canvas");for(var g in e.options)f.setAttribute(g,e.options[g]);return e.canvas=f,e.ctx=e.canvas.getContext("2d"),b&&b.appendChild(f),e}function c(){this.size=[2,4,6,8,10,12,14,16,18,20,22,24,26,28,29,30],
this.arrowPositions=["","B","T","TB"],this._events={},this.shapes=new l(this),this.stateManager=new a,this.getStyle=function(a){return a?b.colorPicker.rgb():this.color},this.generateGradient=function(a){var b=this.ctx.createLinearGradient(a.x,a.y,a.x2,a.y2);return a.gradient.forEach(function(a){b.addColorStop(a.point,a.color)}),b},this.addToStack=function(a,b){b&&(this.stateManager.pushStack(a),this.trigger("interact.send",[a]))}}function d(a,b){return this._events[a]=b,this}function e(a,b){
return this._events[a]&&this._events[a].call(this._events[a],b),this}function f(a,b){var c=document.createElement("div"),d=document.createElement("div"),e=Object.assign({overlay:!0,onOverlayClick:function(){}},b||{}),f={position:"absolute",minWidth:a.clientWidth/2.5+"px",minHeight:a.clientHeight/5.5+"px",top:"40%",left:"30%",padding:"5%"};return d.addEventListener("click",e.onOverlayClick,!1),{destroy:function(){a.removeChild(c),a.removeChild(d),a=null,c=null,
d.removeEventListener("click",e.onOverlayClick),d=null},addContent:function(a){return c.innerHTML=a,this},addEventListener:function(){},addStyle:function(a){var b=document.createElement("style");return b.type="text/css",b.styleSheet?b.styleSheet.cssText=a:b.appendChild(document.createTextNode(a)),c.appendChild(b),this},querySelector:function(a){return c.querySelector(a)},init:function(b){e.overlay&&(d.style.height=a.clientHeight+"px",d.style.width=a.clientWidth+"px",d.style.background="#f0f0f0",
d.style.bottom=a.clientHeight+"px",d.style.position="relative",d.style.opacity="0.5",a.appendChild(d)),a.appendChild(c),f=Object.assign(f,b||{}),b.top&&(b.top+parseInt(f.minHeight)>a.clientHeight?(f.bottom="50px",delete f.top):f.top=b.top+50+"px"),b.left&&(b.left+parseInt(f.minWidth)>a.clientWidth?(f.right="0px",delete f.left):f.left=b.left+"px"),Object.keys(f).forEach(function(a){c.style[a]=f[a]})},hide:function(){c.style.display="none",d.style.display="none"},show:function(){
c.style.display="block",d.style.display="block"}}}function g(a,b){function c(a,b,c,d,e){return{x:a+c*Math.cos(-d*Math.PI/180)*e,y:b+c*Math.sin(-d*Math.PI/180)*e}}var d=b.stacks[0].arg[0],e="arc"===b.stacks[0].event;this.setClips=function(){if(this.clips=[],e)for(var f=0;f<=7;f++){var g=c(d.x,d.y,d.r,45*f,1);g.r=5,this.clips.push(g)}else{var h=b.endY-b.startY,i=b.endX-b.startX;this.clips.push({x:b.startX-5,y:b.startY-5,w:10,h:10}),this.clips.push({x:b.startX+i/2-5,y:b.startY-5,w:10,h:10}),
this.clips.push({x:b.startX+i-5,y:b.startY-5,w:10,h:10}),this.clips.push({x:b.startX-5,y:b.startY+h/2-5,w:10,h:10}),this.clips.push({x:b.endX-5,y:b.endY-h/2-5,w:10,h:10}),this.clips.push({x:b.startX-5,y:b.startY+h-5,w:10,h:10}),this.clips.push({x:b.endX-i/2-5,y:b.endY-5,w:10,h:10}),this.clips.push({x:b.endX-5,y:b.endY-5,w:10,h:10})}a.ctx.fillStyle="darkred",this.clips.forEach(function(b){e?(a.ctx.beginPath(),a.ctx.arc(b.x,b.y,b.r,0,2*Math.PI),a.ctx.fill()):a.ctx.fillRect(b.x,b.y,b.w,b.h)})},
this.getSelectedClip=function(b,c,d){var f=-1;if(this.clips.forEach(function(a,d){if(e){var g=a.x-b,h=a.y-c;g*g+h*h<a.r*a.r&&(f=d)}else b>=a.x&&b<=a.x+a.h&&c>=a.y&&c<=a.y+a.w&&(f=d)}),d&&0<=f){var g=["nw-resize","n-resize","ne-resize","w-resize","e-resize","sw-resize","s-resize","se-resize"];a.canvas.style.cursor=g[f]}return f};var f={arc:function(a,b,c,e,f){d.r=Math.sqrt(Math.pow(e-b,2)+Math.pow(f-c,2))},rect:function(a,b,c,e,f){switch(a){case 0:d.x=b,d.y=c,d.w+=e-b,d.h+=f-c;break;case 1:d.y=c,
d.h+=f-c;break;case 2:d.y=c,d.w=b-e,d.h+=f-c;break;case 3:d.x=b,d.w+=e-b;break;case 4:d.w=b-e;break;case 5:d.x=b,d.w+=e-b,d.h=c-f;break;case 6:d.h=c-f;break;case 7:d.w=b-e,d.h=c-f}}};f.image=f.rect,this.onResize=function(a,c){var e=this.getSelectedClip(a,c,!0);0<=e&&(f[b.stacks[0].event](e,a,c,d.x,d.y),this.redraw())}}function h(a,b,c){
var d=new f(a),e=["serif","Georgia",'"Palatino Linotype"','"Book Antiqua"',"Palatino",'"Times New Roman"',"Times","Arial","Helvetica","sans-serif",'"Arial Black"',"Gadget",'"Comic Sans MS"',"cursive","Impact","Charcoal",'"Lucida Sans Unicode"','"Lucida Grande"',"Tahoma","Geneva",'"Trebuchet MS"',"Helvetica","Verdana",'"Courier New"','"Lucida Console"']
;d.addContent('<div style="padding:.5em 0px">Size: <select id="modalSizePicker"></select> Font:<select id="modalFontPicker"></select></div>        <div><textarea style="width:100%;border: 1px solid #000"></textarea></div>        <div><button style="float:right;">Done</button></div><br clear="both" />');var g=d.querySelector("textarea"),h=d.querySelector("select#modalSizePicker"),i=d.querySelector("select#modalFontPicker"),j=d.querySelector("button");b.text&&(g.value=b.text)
;for(var k="",l=1;l<=50;l++){var m=2*l;k+='<option value="'+m+'"'+(m===b.fontSize?" selected":"")+">"+m+"</option>"}h.innerHTML=k;var n="";e.forEach(function(a){n+="<option value="+a+" style=font-family:"+a+(a===b.fontFamily?" selected":"")+"> "+a+" </option>"}),i.innerHTML=n,j.addEventListener("click",function(){b.text=g.value,b.fontSize=h.value,b.fontFamily=i.value,c(),d.destroy()}),d.init({left:b.x,top:b.y}),g.focus()}function i(a,b,c){if("object"==typeof a){var d,e=new XMLHttpRequest
;switch(e.open(a.method,a.url,a.async||!0),e.onreadystatechange=function(){if(4===e.readyState)if(200===e.status||0==e.status){var f=e.getResponseHeader("content-type");d=/json/.test(a.dataType||f)?JSON.parse(e.responseText):/xml/.test(a.dataType||f)?parseXML(e.responseText):e.responseText,(b||function(){})(d)}else(c||function(){})()},a.method.toLowerCase()){case"post":a.data&&"object"==typeof a.data&&(a.data=JSON.stringify(a.data))}e.send(a.data)}}function j(a){this._options=a.options,
this._events={},self=this,this._childFrames={},this.ajax={post:{method:"POST"},get:{method:"GET"},timer:500},a.$on("interact.send",function(b){self.sendEvent("interaction.stack.received",{user:a.options.id,stack:b})}),this.socketEnabled=!1,this.socket={}}function k(a){function b(b){b.preventDefault();var d=a.canvas,e=c(b),f=d.getBoundingClientRect();h=i,j=k,i=e.clientX-f.left,k=e.clientY-f.top,l.hasOwnProperty(b.type)&&l[b.type]()}function c(a){return{
clientX:a.clientX||(a.targetTouches[0]||{}).clientX,clientY:a.clientY||(a.targetTouches[0]||{}).clientY}}function d(){g&&a.stateManager.drawingState&&a.stateManager.drawingState.listeners.move(i,k,h,j)}function e(){g=!0,a.stateManager.drawingState&&a.stateManager.drawingState.listeners.down(i,k)}function f(){g&&(a.stateManager.drawingState&&a.stateManager.drawingState.listeners.end(h,j),g=!1)}var g=!1,h=0,i=0,j=0,k=0,l={mousedown:e,touchstart:e,mouseout:f,mouseup:f,touchend:f,mousemove:d,
touchmove:d};return b}function l(a){this.rect=function(b){a.ctx.beginPath(),isArray(b.points)&&b.points.forEach(function(c){var d=c.color||b.color||fillStyle;c.stroke?(a.ctx.strokeStyle=d,a.ctx.strokeRect(c.x,c.y,c.w,c.h)):(a.ctx.fillStyle=d,a.ctx.fillRect(c.x,c.y,c.w,c.h))}),a.ctx.closePath()}}function m(){var a,c={total:1,gradientPattern:["0","0.5","1.0"],width:300,height:300},d=this,e={hex:[],rgb:[],gradient:null},g=function(){};this.isHiddenState=!1,this.cleanup=function(){a.canvas.width=0,
a.canvas.height=0,a.destroyState(!0)},this.open=function(h,i,j){function k(a,b){m.querySelector(a).value=b}function l(){if(e.rgb.length>1){var a=e.rgb.length;e.gradient=e.rgb.map(function(b,c){return{point:c/a,color:b}})}}if(c=Object.assign({},c,h),g=j||g,this.isHiddenState)return this.isHiddenState=!1,void this.pickerElement.show();this.pickerElement=new f(i||document.body,{onOverlayClick:function(){d.close()}}),
this.pickerElement.addContent('<div id="colorPicker">        <div class="controls"><div><label>R</label> <input type="text" id="rVal" /></div>         <div><label>G</label> <input type="text" id="gVal" /></div>         <div><label>B</label> <input type="text" id="bVal" /></div>         <div><label>RGB</label> <input type="text" id="rgbVal" /></div>         <div><label>HEX</label> <input type="text" id="hexVal" /></div><div class="preview"></div></div></div>').addStyle("#picker{cursor:crosshair;float:left;margin:10px;border:0}.controls{float:right;margin:10px}.controls>div{border:1px solid #2f2f2f;margin-bottom:5px;overflow:hidden;padding:5px}        .controls label{float:left}.controls>div input{background-color:#121212;border:1px solid #2f2f2f;color:#ddd;float:right;font-size:10px;height:14px;margin-left:6px;text-align:center;text-transform:uppercase;width:75px}        .preview {border-radius:3px;box-shadow:2px 2px 2px #444;} .preview span{cursor:pointer;height:15px;width:15px; display:inline-block; margin-right: 3px;}")
;var m=this.pickerElement.querySelector("div#colorPicker"),n=this.pickerElement.querySelector("div.preview");a=new b({width:c.width||300,height:c.height||300,id:"picker"},m),
img="data:image/png;base64,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",
b.image.call(a,{width:c.width,height:c.height,img:c.img||img,toCanvas:!0},!1),a.init(function(){function b(b,c){var d=a.getImageData(b,c,1,1),f=d.data;k("#rVal",f[0]),k("#gVal",f[1]),k("#bVal",f[2]),k("#rgbVal",f[0]+","+f[1]+","+f[2]);var g=f[2]+256*f[1]+65536*f[0],h="rgb("+f[0]+", "+f[1]+", "+f[2]+")",i=("0000"+g.toString(16)).substr(-6),j=document.createElement("span");j.style.backgroundColor=h,n.appendChild(j),e.rgb.push(h),e.hex.push(i),j=null,l(),k("#hexVal","#"+i)}
a.stateManager.setDrawingState("picker",{down:b,move:function(){},end:function(){c.total===e.hex.length&&(g(e),d.close())}},!0)}),this.pickerElement.init({backgroundColor:"#222",borderRadius:"5px 5px 5px 5px",boxShadow:"2px 2px 2px #444",color:"#fff",fontSize:"12px",padding:"0px"})},this.close=function(){this.isHiddenState=!this.isHiddenState,this.pickerElement.hide(),e={hex:[],rgb:[]}},this.rgb=function(){for(var a="rgb(",b=0;b<3;b++)a+=Math.floor(255*Math.random())+","
;return a.replace(/\,$/,")")}}function n(){var a={},b="boolean"==typeof arguments[0],c=0,d=arguments.length;b&&(c++,b=arguments[0]),"[object Array]"===Object.prototype.toString.call(arguments[c])&&(a=Array(arguments[c].length));for(;c<d;c++)!function(c){for(var d in c)c.hasOwnProperty(d)&&(b&&c[d]&&"object"==typeof c[d]&&!Object.keys(c[d]).length?a[d]=n(!0,a[d],c[d]):a[d]=c[d])}(arguments[c]);return a}return a.prototype.pushStack=function(a){this.selectedState.stacks.push(a)},
a.prototype.isDragableState=function(){return this.selectedState&&this.selectedState.isDragable&&this.selectedState.isDragging},a.prototype.updateState=function(a,b){if(this.selectedState||b){var c=this;Object.keys(a).forEach(function(d){(c.selectedState||b)[d]=a[d]})}},a.prototype.clearState=function(){this.selectedState=null},a.prototype.isSameState=function(a){return a===this.drawingState.type},a.prototype.setDrawingState=function(a,b,c){function d(){e.selectedState=null,
c&&(e.previousState=e.drawingState),e.drawingState&&e.drawingState.onStateChange&&e.drawingState.onStateChange(),e.drawingState={state:a,listeners:b}}var e=this;this.drawingState&&this.isSameState(a)?this.drawingState.listeners.destroyingOnReClick&&this.destroyDraingState():d()},a.prototype.destroyDrawingState=function(a){a&&this.previousState?(this.drawingState=this.previousState,this.previousState=null):(this.drawingState=null,this.previousState=null)},c.prototype.setPenSize=function(a){
this.lineWidth="default"===a?2:parseInt(a)},c.prototype.setColor=function(a){return a&&(this.color=a),this},c.prototype.reScale=function(a){this.options.id==a.user&&(this.canvas.width=a.stack.width,this.canvas.height=a.stack.height)},c.prototype.clear=function(){this.stateManager.reset(b.image.removeImage),b.eraseCanvas.call(this),this.trigger("interact.send",[{event:"clear"}])},c.prototype.eraser=function(){var a=this;this.stateManager.setDrawingState("eraser",{down:function(c,d){
a.stateManager.addState(c,d),b.erase.call(a,c,d,!0)},move:function(c,d){b.erase.call(a,c,d,!0)},end:function(c,d){b.erase.call(a,c,d,!0),a.stateManager.endState(c,d)}})},c.prototype.undo=function(){var a=this.stateManager.pop();b.image.removeImage(a),this.stateManager.valid=!1,b.redraw.call(this),a=null},c.prototype.freeHand=function(){var a=this;this.stateManager.setDrawingState("freeHand",{down:function(c,d){a.stateManager.addState(c,d),b.pencilOnBoard.apply(a,[{color:a.getStyle(!1),x:c,y:d,
lineWidth:a.lineWidth},!0])},move:function(c,d,e,f){b.freeHand.apply(a,[{x:e,y:f,x2:c,y2:d,color:a.getStyle(!1),lineWidth:a.lineWidth},!0])},end:function(b,c){a.stateManager.endState(b,c)}},!1)},c.prototype.dragSelect=function(){var a=this;this.stateManager.setDrawingState("drag",{down:function(b,c){a.stateManager.contains(b,c,!0)},move:function(c,d,e,f){var g=c-e,h=d-f;a.stateManager.forEach(function(c){c.isSelected&&(c.stacks[0].arg[0].x+=g,c.stacks[0].arg[0].y+=h,a.stateManager.valid=!1,
b.redraw.call(a,c))})},end:function(b,c){a.stateManager.forEach(function(a){a.isSelected=!1})}})},c.prototype.fill=function(){var a=this,c=null;this.stateManager.setDrawingState("fill",{down:function(b,d){c=a.stateManager.contains(b,d,!1)},move:function(){},end:function(){c&&b.colorPicker.open({total:3},a.canvas.parentNode,function(d){var e=c.state.stacks[0].arg[0];e.type="fill",d&&(d.gradient?e.gradient=d.gradient:e.color=d.rgb),a.stateManager.valid=!1,b.redraw.call(a)})},
onStateChange:function(){c=null}})},c.prototype.select=function(){var a=this,c=!1,d=null;this.stateManager.setDrawingState("select",{down:function(e,f){var i=a.stateManager.contains(e,f,!1);if(i){if(d&&d.index===i.index)return void(i=null);d=i,i=null,"text"===d.state.stacks[0].event?h(a.canvas.parentNode,d.state.stacks[0].arg[0],function(){a.stateManager.valid=!1,b.redraw.call(a),a.stateManager.clearState()}):(c=new g(a,d.state),c.redraw=function(){a.stateManager.valid=!1,b.redraw.call(a),
this.setClips()},c.setClips())}},move:function(a,b,d,e){c&&c.onResize(a,b,d,e)},end:function(){a.canvas.style.cursor="auto"},onStateChange:function(){c=!1,d=null}})},c.prototype.addImage=function(a){a.w=a.w||this.options.width,a.h=a.h||this.options.height,b.image.call(this,a,!0)},c.prototype.addText=function(a){function c(){e.text&&(d.stateManager.addState(e.x,e.y,!0),b.text.apply(d,[e,!0]),d.stateManager.endState(e.x+e.textWidth,e.y)),f=!1}var d=this,e=n(!0,{fontSize:40,fontFamily:"serif"
},a),f=!1;this.stateManager.setDrawingState("text",{down:function(a,b){f||(f=!0,e.x=a,e.y=b,h(d.canvas.parentNode,e,c))},move:function(){},end:function(){}})},c.prototype.drawArrow=function(a){function c(c,g,h,i){f.stateManager.valid=!1,b.redraw.call(f),b.drawArrow.apply(f,[{points:[{x:d,y:e,y2:g,x2:c}],lineWidth:f.lineWidth,color:h,position:a},i])}if(!a)return void this.stateManager.destroyDrawingState();var d,e,f=this;this.stateManager.setDrawingState("arrow",{down:function(a,b){d=a,e=b,
f.stateManager.addState(a,b,!0)},move:function(a,b){c(a,b,"darkred",!1)},end:function(a,b){c(a,b,f.getStyle(!1),!0),f.stateManager.endState(a,b)}})},c.prototype.drawCircle=function(a,c){function d(d,h,i,j){g.stateManager.valid=!1,b.redraw.call(g);var k=Math.sqrt(Math.pow(e-d,2)+Math.pow(f-h,2)),l=2*Math.PI;"h"===c&&(l=Math.PI),b.arc.apply(g,[{x:e,y:f,s:0,e:l,r:k,lineWidth:g.lineWidth,type:a,color:i},j])}c=c||"f",a=a||"stroke";var e,f,g=this;this.stateManager.setDrawingState("circle",{
down:function(a,b){g.stateManager.addState(a,b,!0),e=a,f=b},move:function(a,b){d(a,b,"darkred",!1)},end:function(a,b){d(a,b,g.getStyle(!1),!0),g.stateManager.endState()}})},c.prototype.drawRect=function(a){function c(c,g,h,i){f.stateManager.valid=!1,b.redraw.call(f),b.rect.apply(f,[{x:d,y:e,w:c-d,h:g-e,lineWidth:f.lineWidth,type:a,color:h},i])}var d,e,f=this;this.stateManager.setDrawingState("rect",{down:function(a,b){f.stateManager.addState(a,b,!0),d=a,e=b},move:function(a,b){
c(a,b,"darkred",!1)},end:function(a,b){c(a,b,f.getStyle(!1),!0),f.stateManager.endState(a,b)}})},c.prototype.drawLine=function(){var a,c,d=this;this.stateManager.setDrawingState("line",{down:function(b,e){d.stateManager.addState(b,e,!0),a=b,c=e},move:function(e,f){d.stateManager.valid=!1,b.redraw.call(d),b.drawLine.apply(d,[{points:[{x:a,y:c,y2:f,x2:e}],lineWidth:d.lineWidth,color:"darkred"},!1])},end:function(e,f){b.drawLine.apply(d,[{points:[{x:a,y:c,y2:f,x2:e}],lineWidth:d.lineWidth,
color:d.getStyle(!1)},!0]),d.stateManager.endState(e,f)}})},c.prototype.init=function(a){var b=k(this);return this.addEventListener(["mousedown","touchstart","touchmove","mousemove","mouseup","mouseout","touchend"],b,!1),(a||function(){})(),this},c.prototype.addStyle=function(a){if(a)for(var b in a)this.canvas.style[b]=a[b];return this},c.prototype.addEventListener=function(a,b){function c(a){d.canvas.addEventListener(a,b)}var d=this;return"object"==typeof a?a.forEach(c):c(a),this},
c.prototype.getDataURL=function(a,b){var c=this.canvas.toDataURL(b||"image/png");(a||function(){})(c)},c.prototype.interact=function(){return new j(this)},c.prototype.colorPicker=function(a){var c=this;b.colorPicker.open(a,this.canvas.parentNode,function(a){c.setColor(a.rgb)})},c.prototype.getImageData=function(a,b,c,d){return this.ctx.getImageData(a,b,c,d)},c.prototype.$on=d,c.prototype.trigger=e,g.prototype.redraw=function(){},j.prototype.connect=function(){
return this.sendEvent("connect.child",{user:this._options.id,stack:this._options}),this},j.prototype.createChildFrame=function(a,c){return this._childFrames[a.user]=new b(a.stack,c),this._childFrames[a.user]},j.prototype.destroyFrame=function(a){delete this._childFrames[a]},j.prototype.sendEvent=function(a,b){var c=this.ajax.post;c.data={type:a,payload:b},this.socketEnabled?this.socket.emit("events.received",c.data):i(c)},j.prototype.watch=function(){var a=this
;return this.socketEnabled||(console.log("-- starting web :http long poll---"),setInterval(function(){a.getEvents()},this.ajax.timer)),a.getEvents(),this},j.prototype.getEvents=function(){var a=this.ajax.get,b=this,c=function(a){b.trigger(a.type,a.payload)};this.socketEnabled?(console.log("-- starting web socket:events.received---"),this.socket.on("events.received",c)):i(a,c)},j.prototype.draw=function(a){var c=this._childFrames[a.user];c&&a.stack.forEach(function(a){b[a.event].apply(c,a.arg)})
},j.prototype.disconnect=function(){return this},j.prototype.$on=d,j.prototype.trigger=e,b.arc=function(a,b,c){this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(a.x,a.y,a.r,a.s,a.e),this.ctx.restore(),a.w=a.x+a.r,a.h=a.y+a.r,a.gradient&&(a.color=this.generateGradient({gradient:a.gradient,x:a.x,y:a.y,x2:a.w,y2:a.h})),"stroke"===a.type?(this.ctx.lineWidth=a.lineWidth,this.ctx.strokeStyle=a.color,this.ctx.stroke()):(this.ctx.fillStyle=a.color,this.ctx.fill()),this.ctx.closePath(),
this.stateManager.updateState({startX:a.x-a.r,startY:a.y-a.r,endX:a.x+a.r,endY:a.y+a.r},c),this.addToStack({arg:[a,!1],event:"arc"},b)},b.drawArrow=function(a,c){function d(b,c,d){var f=2+a.lineWidth,g=18+a.lineWidth;e.ctx.save(),e.ctx.beginPath(),e.ctx.translate(b,c),e.ctx.rotate(d),e.ctx.moveTo(0,0),e.ctx.lineTo(f,g),e.ctx.lineTo(-f,g),e.ctx.closePath(),e.ctx.restore(),e.ctx.fill()}var e=this;b.drawLine.call(this,a,!1),this.ctx.fillStyle=a.color,a.points.forEach(function(b){
var c=endRadians=Math.atan((b.y2-b.y)/(b.x2-b.x));c+=(b.x2>b.x?-90:90)*Math.PI/180,endRadians+=(b.x2>b.x?90:-90)*Math.PI/180,"B"===a.position?d(b.x2,b.y2,endRadians):"T"===a.position?d(b.x,b.y,c):"TB"===a.position&&(d(b.x,b.y,c),d(b.x2,b.y2,endRadians))}),e.addToStack({arg:[a,!1],event:"drawArrow"},c)},b.colorPicker=new m,b.colorPicker.isHiddenState=!1,b.erase=function(a,b,c){this.ctx.beginPath(),this.ctx.globalCompositeOperation="destination-out",this.ctx.arc(a,b,8,0,2*Math.PI,!1),
this.ctx.fill(),this.addToStack({event:"erase",arg:[a,b,!1]},c)},b.eraseCanvas=function(){this.ctx.clearRect(0,0,this.options.width,this.options.height)},b.getPos=function(a){return{x:a.x+a.w,y:a.y+a.h}},b.image=function(a,c,d){if(d){b.image.style(d.imageContainerId,a,this.options.width,this.options.height);var e=b.getPos(a);return void this.stateManager.updateState({startX:a.x,startY:a.y,endX:e.x,endY:e.y},d)}var f=new Image,g=this;f.onload=function(){
var d=this.naturalWidth,e=this.naturalHeight;if(a.hasOwnProperty("x")||(a.w>d?(a.x=(a.w-d)/2,a.w=d):a.x=0),a.hasOwnProperty("y")||(a.h>e?(a.y=(a.h-e)/2,a.h=e):a.y=0),!a.toCanvas){var h=document.createElement("div");h.style.backgroundImage="url("+f.src+")",g.canvas.parentNode.appendChild(h),h.id="_canvas_image_"+ +new Date,b.image.style(h.id,a,g.options.width,g.options.height)}var i=b.getPos(a);c&&(g.stateManager.addState(a.x,a.y,a.dragable),g.addToStack.call(g,{event:"image",arg:[a,!1]},!0),
a.toCanvas||(g.stateManager.selectedState.imageContainerId=h.id),g.stateManager.endState(i.x,i.y)),a.toCanvas&&g.ctx.drawImage(f,a.x,a.y,a.width,a.height)},f.onerror=function(){console.log(a)},f.src=a.img},b.image.style=function(a,b,c,d){var e=document.getElementById(a),f=(window.innerWidth-c)/2,g=(window.innerHeight-d)/2,h={left:b.x+f+"px",top:b.y+g+"px",position:"absolute",width:b.w+"px",height:b.h+"px",zIndex:"-1",backgroundRepeat:"no-repeat"};Object.keys(h).forEach(function(a){
e.style[a]=h[a]})},b.image.removeImage=function(a){if(a&&a.hasOwnProperty("imageContainerId")){var b=document.getElementById(a.imageContainerId);b&&b.parentNode.removeChild(b),b=null}},b.drawLine=function(a,b){this.ctx.strokeStyle=a.color,this.ctx.lineWidth=a.lineWidth;var c=this;this.ctx.beginPath(),a.points.forEach(function(a){c.ctx.moveTo(a.x,a.y),c.ctx.lineTo(a.x2,a.y2)}),this.ctx.stroke(),c.addToStack({arg:[a,!1],event:"drawLine"},b)},b.pencilOnBoard=function(a,b){this.ctx.beginPath(),
this.ctx.fillStyle=a.color,this.ctx.fillRect(a.x,a.y,a.lineWidth,a.lineWidth),this.ctx.closePath(),this.addToStack({event:"pencilOnBoard",arg:[a,!1]},b)},b.freeHand=function(a,b){this.ctx.beginPath(),this.ctx.globalCompositeOperation="source-over",this.ctx.moveTo(a.x,a.y),this.ctx.lineTo(a.x2,a.y2),this.ctx.strokeStyle=a.color,this.ctx.lineWidth=a.lineWidth,this.ctx.lineCap="round",this.ctx.stroke(),this.ctx.closePath(),this.addToStack({arg:[a,!1],event:"freeHand"},b)},b.rect=function(a,c,d){
this.ctx.beginPath(),this.ctx.save(),this.ctx.rect(a.x,a.y,a.w,a.h),this.ctx.restore();var e=b.getPos(a);a.gradient&&(a.color=this.generateGradient({gradient:a.gradient,x:a.x,y:a.y,x2:e.x,y2:e.y})),"stroke"===a.type?(this.ctx.lineWidth=a.lineWidth,this.ctx.strokeStyle=a.color,this.ctx.stroke()):(this.ctx.fillStyle=a.color,this.ctx.fill()),this.ctx.closePath(),this.stateManager.updateState({startY:a.y,startX:a.x,endX:e.x,endY:e.y},d),this.addToStack({arg:[a,!1],event:"rect"},c)},
b.redraw=function(){if(!this.stateManager.valid){b.eraseCanvas.call(this);var a=this;this.stateManager.forEach(function(c){c.stacks.forEach(function(d){b[d.event].call(a,d.arg[0],d.arg[1],c)})}),this.stateManager.valid=!0}},b.text=function(a,c,d){if(b.text.scale.call(this,a),a.style){var e=this;Object.keys(a.style).forEach(function(b){e.ctx[b]=a.style[b]})}this.ctx.font=a.fontSizesize+"px "+a.fontFamily,"stroke"===a.type?(this.ctx.strokeStyle=a.color,
this.ctx.stokeText(a.text,a.x,a.y)):(this.ctx.fillStyle=a.color,this.ctx.fillText(a.text,a.x,a.y)),this.stateManager.updateState({startX:a.x,startY:a.y-a.fontSize,endX:a.x2,endY:a.y2,selectable:a.selectable||!0},d),this.addToStack({event:"text",arg:[a,!1]},c)},b.text.scale=function(a){var b=parseInt(a.fontSize||lineWidth);a.fontFamily=a.fontFamily||"serif",this.ctx.font=b+"px "+a.fontFamily;var c=this.ctx.measureText(a.text);a.textWidth=c.width,a.fontSize=b,a.color=a.color||this.getStyle(!1),
a.x=a.x||(this.options.width-c.width)/2,a.y=a.y||(this.options.height-b)/2,a.x2=a.x+a.textWidth,a.y2=a.y+a.fontSize,a.gradient&&(a.color=this.generateGradient(a))},b}),b.true=a}({},function(){return this}());
//# sourceMappingURL=jeli.sketch.min.js.map